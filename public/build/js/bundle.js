$(function(){var e=$("body");e.on("click",".melis-dashboard-plugin-creator-steps-content .btn-steps",function(){var e=$(this).data("curstep"),a=$(this).data("nextstep"),i=(new Array,new FormData),t=$(".melis-dashboard-plugin-creator-steps-content form.dashboard-plugin-creator-step-"+e);$("form.dashboard-plugin-creator-step-"+e+" .form-control").parents(".form-group").find("label").css("color","#686868"),t.each(function(e,a){var t=$(this).closest("form").attr("name"),n=$("form[name="+t+"]").length,s=new FormData($(this)[0]).entries();for(var l of s)n>1?i.append("step-form["+e+"]["+l[0]+"]",l[1]):i.append("step-form["+l[0]+"]",l[1]);$(this).find('input[type="radio"]:not(:checked),input[type="checkbox"]:not(:checked),input[type="text"][value=""],select[value=""]').each(function(){if(n>1)var a="step-form["+e+"]["+this.name+"]";else a="step-form["+this.name+"]";i.has(a)||i.append(a,"")})}),i.append("curStep",e),i.append("nextStep",a),$(this).hasClass("dpc-validate")&&i.append("validate",!0),$("#id_melisdashboardplugincreator_steps").append('<div id="loader" class="overlay-loader"><img class="loader-icon spinning-cog" src="/MelisCore/assets/images/cog12.svg" data-cog="cog12"></div>'),$.ajax({type:"POST",url:"/melis/MelisDashboardPluginCreator/DashboardPluginCreator/renderDashboardPluginCreatorSteps",data:i,dataType:"json",encode:!0,cache:!1,contentType:!1,processData:!1}).done(function(a){$("#id_melisdashboardplugincreator_steps #loader img").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){if(a.errors)a.errors.dpc_plugin_upload_thumbnail&&$(".plugin_thumbnail_div").length&&$(".plugin_thumbnail_div").remove(),melisHelper.melisKoNotification(a.textTitle,a.textMessage,a.errors),t=a.errors,n=".dashboard-plugin-creator-step-"+e,$.each(t,function(e,a){e.indexOf("dpc_plugin_tab_icon")>=0&&$("form"+n+" label#dashboard_tab_icon_field_title").css("color","red"),$("form"+n+" .form-control[name='"+e+"']").parents(".form-group").find("label").css("color","red")}),$("#id_melisdashboardplugincreator_steps #loader").remove();else if(a.textMessage)melisHelper.melisKoNotification(a.textTitle,a.textMessage,a.errors),$("#id_melisdashboardplugincreator_steps #loader").remove();else{$("#id_melisdashboardplugincreator_steps").html(a.html),$(".melis-dashboard-plugin-creator-steps li").removeClass("active");var i=$("#id_melisdashboardplugincreator_steps .steps-content").attr("id");$("#dpc_"+i).addClass("active")}var t,n},500)}).fail(function(e,a,i){console.log(translations.tr_meliscore_error_message)})}),e.on("change","#dashboard-plugin-creator-step-1 input[name='dpc_plugin_type']",function(){"multi"==$("input:radio[name=dpc_plugin_type]:checked").val()?$("#tab_count_div").show():($("#tab_count_div").hide(),$("#dpc_tab_count").val(""))}),e.on("change","#dashboard-plugin-creator-step-1 input[name='dpc_plugin_destination']",function(){"new_module"==$("input:radio[name=dpc_plugin_destination]:checked").val()?($("#dpc_new_module_name").parents(".form-group").show(),$("#dpc_existing_module_name").parents(".form-group").hide(),$("#dpc_existing_module_name option").prop("selected",!1)):($("#dpc_new_module_name").parents(".form-group").hide(),$("#dpc_new_module_name").val(""),$("#dpc_existing_module_name").parents(".form-group").show())}),e.on("click",".melis-dpc-final-content .fa",function(){$(this).hasClass("fa-check-square-o")?($(this).addClass("fa-square-o"),$(this).removeClass("text-success"),$(this).removeClass("fa-check-square-o"),$(this).next("input").attr("checked",!1)):($(this).removeClass("fa-square-o"),$(this).addClass("fa-check-square-o"),$(this).addClass("text-success"),$(this).next("input").attr("checked",!0))}),e.on("click",".close-tab",function(e){$.ajax({type:"POST",url:"/melis/MelisDashboardPluginCreator/DashboardPluginCreator/removeTempThumbnailDir",data:{},dataType:"text"}).done(function(e){}).fail(function(e,a,i){console.log(translations.tr_meliscore_error_message)})}),e.on("change","#dpc_plugin_upload_thumbnail",function(e){var a=$(this)[0].value,i=a.substring(a.lastIndexOf(".")+1).toLowerCase();if("gif"==i||"png"==i||"jpg"==i||"jpeg"==i){if("undefined"!=typeof FileReader){var t=$("#pluginThumbnailUploadArea"),n=$(".plugin_thumbnail_div");n.length?n.empty():$('<div class="plugin_thumbnail_div"></div>').appendTo(t);var s=new FileReader;s.onload=function(e){$("<img />",{src:e.target.result,class:"plugin_thumbnail"}).appendTo(".plugin_thumbnail_div"),$('<div class="hover-details"><div class="me-p-btn-cont"><a id="plugin-thumbnail-eye" class="viewImageDocument" href="" target="_blank"><i class="fa fa-eye"></i></a><a id="removePluginThumbnail" data-type="image"><i class="fa fa-times"></i></a></div></div>').appendTo(".plugin_thumbnail_div"),$("#plugin-thumbnail-eye").attr("href",e.target.result)},$("#pluginThumbnailFileName").val($(this)[0].files[0].name),n.show(),s.readAsDataURL($(this)[0].files[0])}}else $("#dpc_plugin_upload_thumbnail").val(""),$(".plugin_thumbnail_div").remove(),melisHelper.melisKoNotification(translations.tr_melisdashboardplugincreator_menu_texts_display,translations.tr_melisdashboardplugincreator_save_upload_image_imageFalseType,null)}),e.on("click","#removePluginThumbnail",function(){$(this);var e=[];e.push({name:"pluginFilename",value:$("#pluginThumbnailFileName").val()}),melisCoreTool.pending("#removePluginThumbnail"),melisCoreTool.confirm(translations.tr_melisdashboardplugincreator_common_label_yes,translations.tr_melisdashboardplugincreator_common_label_no,translations.tr_melisdashboardplugincreator_delete_plugin_thumbnail_title,translations.tr_melisdashboardplugincreator_delete_plugin_thumbnail_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisDashboardPluginCreator/DashboardPluginCreator/removePluginThumbnail",data:e,dataType:"json",encode:!0}).done(function(e){e.success?($("#dpc_plugin_upload_thumbnail").val(""),$(".plugin_thumbnail_div").remove(),melisHelper.melisOkNotification(translations.tr_melisdashboardplugincreator_delete_plugin_thumbnail_title,translations.tr_melisdashboardplugincreator_delete_plugin_thumbnail_success)):melisHelper.melisKoNotification(translations.tr_melisdashboardplugincreator_delete_plugin_thumbnail_title,translations.tr_melisdashboardplugincreator_delete_plugin_thumbnail_error,null),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done("#removePluginThumbnail")})});
